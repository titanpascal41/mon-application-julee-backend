// Schéma Prisma basé sur les formulaires frontend de l'application Julee
// Ce schéma correspond exactement aux champs affichés dans les formulaires

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ============================================
// GESTION DES UTILISATEURS ET PROFILS
// ============================================

model User {
  id               Int      @id @default(autoincrement())
  prenom           String
  nom              String
  email            String   @unique
  motDePasse       String
  profilId         Int
  description      String?
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  profil           Profil   @relation(fields: [profilId], references: [id])
  demandes         Demande[]
  
  @@map("users")
}

// Formulaire Profil : uniquement "nom" (pas de description dans le frontend)
model Profil {
  id               Int      @id @default(autoincrement())
  nom              String   @unique
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  utilisateurs     User[]
  
  @@map("profils")
}

// ============================================
// GESTION DES SOCIÉTÉS
// ============================================

// Formulaire Société : nom, adresse, email, telephone, responsable
model Societe {
  id               Int      @id @default(autoincrement())
  nom              String   @unique
  adresse          String?
  email            String?
  telephone        String?
  responsable      String?
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  demandes         Demande[]
  unitesOrganisationnelles UniteOrganisationnelle[]
  
  @@map("societes")
}

// ============================================
// GESTION DES UNITÉS ORGANISATIONNELLES
// ============================================

// Formulaire UO : nom, type, actif, societeId
model UniteOrganisationnelle {
  id               Int      @id @default(autoincrement())
  nom              String   @unique
  type             String?
  actif            Boolean  @default(true)
  societeId        Int?
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  societe          Societe? @relation(fields: [societeId], references: [id])
  demandes         Demande[]
  
  @@map("unites_organisationnelles")
}

// ============================================
// GESTION DES STATUTS
// ============================================

// Formulaire Statut : nom, description, actif
model Statut {
  id               Int      @id @default(autoincrement())
  nom              String   @unique
  description      String?
  actif            Boolean  @default(true)
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  demandes         Demande[]
  
  @@map("statuts")
}

// ============================================
// GESTION DES COLLABORATEURS
// ============================================

// Formulaire Collaborateur : nom, email, poste, telephone, actif
model Collaborateur {
  id               Int      @id @default(autoincrement())
  nom              String
  email            String   @unique
  poste            String?
  telephone        String?
  actif            Boolean  @default(true)
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  @@map("collaborateurs")
}

// ============================================
// GESTION DES DEMANDES
// ============================================

model Demande {
  id                         Int      @id @default(autoincrement())
  titre                      String
  description                String?  @db.Text
  typeProjet                 String?
  dateCreation               DateTime @default(now())
  dateModification           DateTime @updatedAt
  utilisateurId              Int
  societeId                  Int
  uniteOrganisationnelleId   Int
  statutId                   Int
  priorite                   String?
  dateEcheance               DateTime?
  
  utilisateur                User                    @relation(fields: [utilisateurId], references: [id])
  societe                    Societe                 @relation(fields: [societeId], references: [id])
  uniteOrganisationnelle     UniteOrganisationnelle  @relation(fields: [uniteOrganisationnelleId], references: [id])
  statut                     Statut                  @relation(fields: [statutId], references: [id])
  
  @@map("demandes")
}

// ============================================
// GESTION DES SPRINTS
// ============================================

// Formulaire Sprint : nom, description, dateDebut, dateFin, dateValidationSI, dateReponseDEV, dateReponseTIV
model Sprint {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?  @db.Text
  dateDebut            DateTime
  dateFin              DateTime
  dateValidationSI     DateTime?
  dateReponseDEV       DateTime?
  dateReponseTIV       DateTime?
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("sprints")
}

// ============================================
// GESTION DES RESSOURCES
// ============================================

// Formulaire Ressource : nom, type, disponibiliteHJ, tauxJournalier
model Ressource {
  id               Int      @id @default(autoincrement())
  nom              String
  type             String
  disponibiliteHJ  Float
  tauxJournalier   Float
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  @@map("ressources")
}

// ============================================
// GESTION DES DÉLAIS
// ============================================

// Formulaire Délai : dateValidationSI, dateReponseDEV, dateReponseTIV
model Delai {
  id               Int      @id @default(autoincrement())
  dateValidationSI DateTime?
  dateReponseDEV   DateTime?
  dateReponseTIV   DateTime?
  dateCreation     DateTime @default(now())
  dateModification DateTime @updatedAt
  
  @@map("delais")
}

// ============================================
// GESTION DES COÛTS
// ============================================

// Formulaire Coût : chargePrevisionnelleDEV, chargeEffectiveDEV, tjmDEV, chargePrevisionnelleTIV, chargeEffectiveTIV, tjmTIV
model Cout {
  id                      Int      @id @default(autoincrement())
  chargePrevisionnelleDEV Float?
  chargeEffectiveDEV      Float?
  tjmDEV                  Float?
  chargePrevisionnelleTIV Float?
  chargeEffectiveTIV      Float?
  tjmTIV                  Float?
  dateCreation            DateTime @default(now())
  dateModification        DateTime @updatedAt
  
  @@map("couts")
}

// ============================================
// GESTION DES RECETTES
// ============================================

// Formulaire Recette : dateDebut, dateFin, anomaliesBloquantes, anomaliesMajeures, anomaliesMineures, statutGlobal, commentairesGP
model Recette {
  id                   Int      @id @default(autoincrement())
  dateDebut            DateTime
  dateFin              DateTime?
  anomaliesBloquantes  Int      @default(0)
  anomaliesMajeures    Int      @default(0)
  anomaliesMineures    Int      @default(0)
  statutGlobal         String
  commentairesGP       String?  @db.Text
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("recettes")
}

// ============================================
// GESTION DES UAT
// ============================================

// Formulaire UAT : dateDebutUAT, dateFinUAT, statutUAT, nombreRetoursUAT, reservesMetier, commentaireUAT, signatureValidationClient, planAction
model UAT {
  id                        Int      @id @default(autoincrement())
  dateDebutUAT              DateTime
  dateFinUAT                DateTime
  statutUAT                 String
  nombreRetoursUAT          Int      @default(0)
  reservesMetier            String?  @db.Text
  commentaireUAT            String?  @db.Text
  signatureValidationClient String?
  planAction                String?  @db.Text
  dateCreation              DateTime @default(now())
  dateModification          DateTime @updatedAt
  
  @@map("uat")
}

// ============================================
// GESTION DES LIVRAISONS
// ============================================

// Formulaire Livraison : numeroVersion, releaseNotes, dateLivraisonPrevue, dateLivraisonEffective, dateDeploiement, responsableDevOps, statutLivraison, commentaireLivraison
model Livraison {
  id                      Int      @id @default(autoincrement())
  numeroVersion           String
  releaseNotes            String   @db.Text
  dateLivraisonPrevue     DateTime
  dateLivraisonEffective  DateTime?
  dateDeploiement         DateTime?
  responsableDevOps       String?
  statutLivraison         String
  commentaireLivraison    String?  @db.Text
  dateCreation            DateTime @default(now())
  dateModification        DateTime @updatedAt
  
  @@map("livraisons")
}
