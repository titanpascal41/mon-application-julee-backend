// Schéma Prisma pour l'application Julee
// Placez ce fichier dans votre dossier backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Modèles existants (déjà dans votre base de données)
model User {
  id          Int      @id @default(autoincrement())
  prenom      String
  nom         String
  email       String   @unique
  motDePasse  String
  profilId    Int
  description String?
  dateCreation DateTime @default(now())
  dateModification DateTime @updatedAt
  profil      Profil   @relation(fields: [profilId], references: [id])
  demandes    Demande[]
  @@map("users")
}

model Profil {
  id           Int    @id @default(autoincrement())
  nom          String @unique
  description  String?
  dateCreation DateTime @default(now())
  dateModification DateTime @updatedAt
  utilisateurs User[]
  @@map("profils")
}

model Societe {
  id           Int    @id @default(autoincrement())
  nom          String @unique
  description  String?
  dateCreation DateTime @default(now())
  dateModification DateTime @updatedAt
  demandes     Demande[]
  @@map("societes")
}

model UniteOrganisationnelle {
  id           Int    @id @default(autoincrement())
  nom          String @unique
  description  String?
  dateCreation DateTime @default(now())
  dateModification DateTime @updatedAt
  demandes     Demande[]
  @@map("unites_organisationnelles")
}

model Statut {
  id           Int    @id @default(autoincrement())
  nom          String @unique
  description  String?
  dateCreation DateTime @default(now())
  dateModification DateTime @updatedAt
  demandes     Demande[]
  @@map("statuts")
}

model Demande {
  id                    Int    @id @default(autoincrement())
  titre                 String
  description           String?
  dateCreation          DateTime @default(now())
  dateModification      DateTime @updatedAt
  utilisateurId         Int
  societeId             Int
  uniteOrganisationnelleId Int
  statutId              Int
  
  utilisateur          User   @relation(fields: [utilisateurId], references: [id])
  societe               Societe @relation(fields: [societeId], references: [id])
  uniteOrganisationnelle UniteOrganisationnelle @relation(fields: [uniteOrganisationnelleId], references: [id])
  statut                Statut @relation(fields: [statutId], references: [id])
  
  @@map("demandes")
}

model Collaborateur {
  id           Int    @id @default(autoincrement())
  nom          String
  prenom       String
  email        String @unique
  telephone    String?
  dateCreation DateTime @default(now())
  dateModification DateTime @updatedAt
  @@map("collaborateurs")
}

// Nouveaux modèles pour les 8 modules

model Sprint {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?
  dateDebut            DateTime
  dateFin              DateTime
  dateValidationSI     DateTime?
  dateReponseDEV       DateTime?
  dateReponseTIV       DateTime?
  etape                String?
  evenementImportant   String?
  pointsControle       Json?    // Tableau de points de contrôle
  ressources           Json?    // Tableau des ressources avec type, disponibilite, tjm
  respectPlanning      Boolean  @default(false)
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("sprints")
}

model Ressource {
  id                Int      @id @default(autoincrement())
  nom               String
  type              String   // "DEV" ou "TIV"
  disponibiliteHJ    Float    // Homme/Jour
  tauxJournalier    Float    // TJM
  actif             Boolean  @default(true)
  dateCreation      DateTime @default(now())
  dateModification  DateTime @updatedAt
  
  @@map("ressources")
}

model Recette {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?
  dateDebut            DateTime
  dateFin              DateTime
  anomaliesBloquantes  Int      @default(0)
  anomaliesMajeures    Int      @default(0)
  anomaliesMineures    Int      @default(0)
  statutGlobal         String   // "En cours", "OK", "KO", "Bloquée"
  pointsControle       Json?    // Tableau de points de contrôle
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("recettes")
}

model Livraison {
  id                   Int      @id @default(autoincrement())
  numeroVersion        String
  description          String?
  datePrevue           DateTime
  dateEffective        DateTime?
  statut               String   // "Prévue", "En cours", "OK", "KO"
  comiteGONOGOValide   Boolean  @default(false)
  dateValidationComite DateTime?
  notes                String?
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("livraisons")
}

model UAT {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?
  dateDebut            DateTime
  dateFin              DateTime
  statut               String   // "Accepté", "Accepté avec réserve", "Refusé"
  testeurs             Json?    // Tableau des testeurs
  resultats            Json?    // Résultats détaillés des tests
  observations         String?
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("uat")
}

model Delai {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?
  dateDebut            DateTime
  dateFin              DateTime
  typeDelai            String   // Ex: "Développement", "Test", "Validation", etc.
  statut               String   // Ex: "Planifié", "En cours", "Terminé", "Retard"
  responsable          String?
  observations         String?
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("delais")
}

model Cout {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?
  typeCout             String   // Ex: "Développement", "Infrastructure", "Licence", etc.
  montant              Float
  devise               String   @default("EUR")
  dateDebut            DateTime
  dateFin              DateTime?
  statut               String   // Ex: "Prévu", "Réel", "Annulé"
  responsable          String?
  observations         String?
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("couts")
}

model CadreTemporel {
  id                   Int      @id @default(autoincrement())
  nom                  String
  description          String?
  dateDebut            DateTime
  dateFin              DateTime
  typeCadre            String   // Ex: "Sprint", "Phase", "Projet", etc.
  statut               String   // Ex: "Planifié", "Actif", "Terminé"
  phases               Json?    // Tableau des phases ou jalons
  observations         String?
  dateCreation         DateTime @default(now())
  dateModification     DateTime @updatedAt
  
  @@map("cadre_temporel")
}
