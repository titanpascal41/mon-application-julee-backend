generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Societe {
  id           Int       @id @default(autoincrement())
  nom          String    @unique
  responsable  String?
  adresse      String?
  telephone    String?
  email        String?
  dateCreation DateTime?

  demandes Demande[]
  uos      UniteOrganisationnelle[]
}

model UniteOrganisationnelle {
  id           Int           @id @default(autoincrement())
  nom          String
  type         String? // Chef de l'UO dans le frontend
  description  String?
  responsable  String?
  societeId    Int
  actif        Boolean       @default(true)
  dateCreation DateTime?
  societe      Societe       @relation(fields: [societeId], references: [id])
  utilisateurs Utilisateur[]
}

model Profil {
  id  Int    @id @default(autoincrement())
  nom String @unique

  utilisateurs Utilisateur[]
}

model Statut {
  id          Int     @id @default(autoincrement())
  nom         String  @unique
  description String?
  couleur     String?
  ordre       Int?
  actif       Boolean @default(true)
}

model Utilisateur {
  id          Int     @id @default(autoincrement())
  prenom      String
  nom         String
  email       String  @unique
  motDePasse  String
  description String?
  actif       Boolean @default(true)
  profilId    Int
  uoId        Int? // Liaison avec l'UO

  profil Profil                  @relation(fields: [profilId], references: [id])
  uo     UniteOrganisationnelle? @relation(fields: [uoId], references: [id])
}

model Collaborateur {
  id        Int     @id @default(autoincrement())
  nom       String
  email     String
  poste     String?
  telephone String?
  actif     Boolean @default(true)

  demandes Demande[]
}

model Demande {
  id                   Int      @id @default(autoincrement())
  dateReception        DateTime
  dateEnregistrement   DateTime @default(now())
  societesDemandeurs   Json // Tableau d'IDs de sociétés
  typeProjet           String?
  nomProjet            String?
  descriptionPerimetre String?
  perimetre            String?
  isDraft              Boolean  @default(false)

  // Champs de workflow
  dateSoumissionBacklog      DateTime?
  lienCompteRendu            String?
  redacteurBacklog           String?
  dateValidationBacklog      DateTime?
  dateElaborationDATFL       DateTime?
  dateValidationDATFL        DateTime?
  dateElaborationPlanningDEV DateTime?
  dateValidationPlanningDEV  DateTime?
  statutSoumission           String?

  societeId        Int?
  interlocuteurId  Int?
  dateCreation     DateTime?
  dateModification DateTime?

  societe       Societe?       @relation(fields: [societeId], references: [id])
  interlocuteur Collaborateur? @relation(fields: [interlocuteurId], references: [id])

  couts  CoutProduit[]
  delais DelaiPlanCharge[]
}

model Ressource {
  id              Int     @id @default(autoincrement())
  nom             String
  type            String
  disponibiliteHJ Float
  tauxJournalier  Float
  actif           Boolean @default(true)
}

model DelaiPlanCharge {
  id               Int       @id @default(autoincrement())
  dateValidationSI DateTime
  dateReponseDEV   DateTime?
  dateReponseTIV   DateTime?
  delaiDEV         Int?
  respectDelaiDEV  Boolean?
  delaiTIV         Int?
  respectDelaiTIV  Boolean?

  demandeId Int?
  demande   Demande? @relation(fields: [demandeId], references: [id])
}

model CoutProduit {
  id                      Int    @id @default(autoincrement())
  chargePrevisionnelleDEV Float?
  chargeEffectiveDEV      Float?
  tjmDEV                  Float?
  chargePrevisionnelleTIV Float?
  chargeEffectiveTIV      Float?
  tjmTIV                  Float?
  coutPrevuDEV            Float?
  coutReelDEV             Float?
  coutPrevuTIV            Float?
  coutReelTIV             Float?
  coutReelTotal           Float?
  netAPayer               Float?
  ecart                   Float?

  demandeId Int?
  demande   Demande? @relation(fields: [demandeId], references: [id])
}

model RoadmapPhase {
  id               Int       @id @default(autoincrement())
  nom              String
  description      String?
  dateDebut        DateTime?
  dateFin          DateTime?
  statut           String?
  objectifs        Json?
  dateCreation     DateTime?
  dateModification DateTime?
}

model CadreTemporel {
  id               Int       @id @default(autoincrement())
  nom              String
  description      String?
  type             String?
  dateDebut        DateTime?
  dateFin          DateTime?
  dateCreation     DateTime?
  dateModification DateTime?
}

model Sprint {
  id        Int       @id @default(autoincrement())
  nom       String
  statut    String?
  dateDebut DateTime?
  dateFin   DateTime?
}

model Recette {
  id                  Int       @id @default(autoincrement())
  dateDebut           DateTime?
  dateFin             DateTime?
  anomaliesBloquantes Int       @default(0)
  anomaliesMajeures   Int       @default(0)
  anomaliesMineures   Int       @default(0)
  statut              String?
  commentaires        String?
  gp                  String?
  dateCreation        DateTime?
  dateModification    DateTime?

  livraisons Livraison[]
}

model UAT {
  id               Int       @id @default(autoincrement())
  nom              String
  description      String?
  dateDebut        DateTime?
  dateFin          DateTime?
  statut           String?
  resultat         String?
  testeur          String?
  version          String?
  dateCreation     DateTime?
  dateModification DateTime?
}

model Livraison {
  id               Int       @id @default(autoincrement())
  numeroVersion    String
  dateLivraison    DateTime?
  statut           String?
  environnement    String?
  commentaires     String?
  dateCreation     DateTime?
  dateModification DateTime?

  recetteId Int?
  recette   Recette? @relation(fields: [recetteId], references: [id])
}
